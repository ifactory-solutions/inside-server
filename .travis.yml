sudo: required

services:
  - docker
  - docker-compose

env:
  global:
    - MONGODB_URL: mongodb://localhost:27017/test

before_install:
  - nvm install $(jq -r '.engines.node' package.json)
  - npm i -g npm@$(jq -r '.engines.npm' package.json)
  - docker-compose -f docker-compose.test.yml up -d mongo

install: npm i --quiet

language: node_js

cache:
  directories:
    - "node_modules"

script: npm test -- --coverage

after_success: bash <(curl -s https://codecov.io/bash)
